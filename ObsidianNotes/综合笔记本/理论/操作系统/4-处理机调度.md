## 分级调度

### 调度层次

作业调度：按一定原则选择外存后备队列中的作业，为其分配内存等资源，并建立进程，使其获得竞争处理机的资格，进入就绪队列。此外，在作业执行完毕时，回收系统资源。

交换调度：按给定策略，将外存中处于就绪状态或等待状态的进程调入内存，或将内存中暂时不能运行的进程调至外存，以提高内存利用率和系统吞吐量。

进程调度：决定就绪队列中的哪个进程应获得处理机，为其进行进程上下文切换以建立相应的执行环境。

线程调度：进程中相关堆栈和控制表等的调度。

### 作业状态

1. 提交状态：一个作业处于从输入设备进入外部存储设备的过程时所处的状态。
2. 后备状态：作业的全部信息都已通过输入设备输入到外存输入井中，等待进入内存。
3. 执行状态：作业一旦被作业调度程序选中，则为其分配所需的资源，并创建进程，送入内存中投入运行。
4. 完成状态：作业运行完毕，准备退出系统时的状态（所占用的资源尚未全部被系统回收）

作业是用户向计算机提交任务的任务实体，进程是计算机为了完成用户任务实体而设置的执行实体。计算机要完成一个任务实体，必须要有一个以上的执行实体，即一个作业是由一个以上的进程组成的。

## 作业调度

### 周转时间

作业从提交到执行完成所经历的时间。包括：在收容队列中等待，CPU上执行，就绪队列和阻塞队列中等待，结果输出等待等。

### 平均周转时间

假定某作业$i$的提交时间为$T_{si}$，完成时间为$T_{ei}$

作业的周转时间为：$T_i=T_{ei}-T_{si}$

作业的平均周转时间为：$T=\frac{1}{n}\sum_{i=1}^{n}T_i$，其中n为作业流中的作业数量。

### 平均带权周转时间

作业的带权周转时间为：$W_i=T_i/r_i$

作业的平均带权周转时间为：$W=\frac{1}{n}\sum_{i=1}^{n}\frac{T_i}{r_i}$，其中$r_i$，为作业$i$的实际执行时间。

## 进程调度

1. 进程调度的任务是控制协调进程对CPU的竞争，即按一定的调度算法从就绪队列中选择一个进程，并把CPU的使用权交给被选中的进程。
2. 进程调度的功能是记录所有进程的执行状况；按一定策略，选择一个就绪进程；完成进程上下文切换。
3. 作业调度对除了CPU之外的所有系统资源进行分配；进程调度专门负责对CPU进行分配，使进程活动起来。

### 调度算法

#### 先来先服务算法

（FCFS——First Come First Server）：按照作业提交/进程变为就绪状态的先后次序，调入系统或分派CPU。

#### 时间片轮转法

（RR——Round Robin）：

* 将系统中所有的就绪进程按照FCFS原则，排成一个队列。
* 每次调度时将CPU分派给队首进程，让其执行一个时间片。时间片的长度从几毫秒到几百毫秒。
* 在一个时间片结束时，发生时钟中断。调度程序据此暂停当前进程的执行，将其送到就绪队列的末尾，并通过上下文切换执行当前的队首进程。
* 进程可以未使用完一个时间片就提前调度（如完成/阻塞）

#### 短作业优先法

（SJF——Shortest Job First）：对预计执行时间短的作业（进程）优先处理。通常后来的短作业不抢先正在执行的作业。其目标是减少平均周转时间。

优点：

* 缩短作业的等待时间
* 提高系统的吞吐量
* 比FCFS平均周转时间和平均带权周转时间短

缺点：

* 对长作业非常不利，可能长时间得不到执行
* 未能依据作业的紧迫程度来划分执行的优先级
* 难以准确估计作业（进程）的执行时间，从而影响调度性能

#### 最高响应比优先法

（HRN——Highest Response_Ratio Next）：最高响应比优先法是介于FCFS和SJF之间的一种拆衷的算法，同时考虑每个作业的等待时间和估计需要的运行时间，从中选出响应比最高的作业投入运行。
$$
响应比=\frac{响应时间}{运行时间}\\
相应时间=作业进入系统的等待时间+估计的作业运行时间\\
相应比=1+\frac{作业等待时间}{运行时间}
$$

#### 多级队列算法

（Multiple-level Queue）：根据作业或进程的性质或类型的不同，将后备或就绪队列在分为若干个子队列，各队列有不同的调度算法。多级队列：该算法将系统中的进程就绪队列从一个拆分为若干个，将不同类型或性质的进程固定分配在不同的就绪队列，不同的就绪队列采用不同的调度算法，一个就绪队列中的进程可以设置不同的优先级，不同的就绪队列本身也可以设置不同的优先级。

多级队列调度算法由于设置多个就绪队列，因此对每个就绪队列就可以实施不同的调度算法，因此，系统针对不同用户进程的需求，很容易提供多种调度策略。

#### 优先级算法

（Priority Scheduling）：对优先级高的作业/进程优先处理，可分为抢先式和非抢先式。

##### 静态优先级

根据作业/进程的静态特性，优先级在作业/进程开始执行前就确定，直到终止都不改变。通常是一个整数。（静态优先级可由用户/系统/操作员确定）

确定静态优先级的依据：

* 作业/进程类型（如：系统进程优先级较高）
* 用户要求（紧迫程度和付费多少：系统对高优先级用户收取较高的费用）
* 对资源的需求（对CPU和内存需求较少的进程，优先级较高）

##### 动态优先级

创建时赋予的优先级，在运行过程中可以不断改变，以便获得更好的调度性能。

* 在就绪队列中，等待CPU时间越长，则优先级提高，从而使优先级较低的进程在等待足够的时间后，其优先级提高到可被调度执行。
* 进程占有CPU时间越长，或每执行一个时间片，则优先级降低，从而一个进程持续执行时，其优先级可降低到出让CPU。

#### 多级反馈轮转法

（Round Robin with Multiple Feedback）：时间片轮转法和优先级法的综合和发展。

* 设置多个就绪队列，分别赋予不同的优先级，如：
  1. 优先级逐级降低，队列1的优先级最高。
  2. 每个队列执行时间片的长度也不同，规定优先级越低，则时间片越长，如逐级加倍。
* 每个队列按FCFS原则排队
* 同一队列内优先级相同
* 仅当较高优先级的队列为空，才调度较低优先级的队列中的进程执行
* 新进程进入内存后，先投入队列1的队尾；若按队列1的下一个时间片未能执行完，则降低投入到队列2的末尾；如此下去，直到最后一个队列（最低级）